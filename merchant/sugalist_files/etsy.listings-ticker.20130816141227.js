define("etsy.listings-ticker",["jquery"],function(t){var e=function(e,i){this.options=t.extend({api_path:"/api/v2/ajax/homepage_ticker",max_rows:2,per_row:8,start_rows:2,tickerSel:".ticker",enableSel:".enable",statusSel:".status",errorSel:".status .error",regionEmptySel:".status .empty-region",loadingSel:".status .loading",delay:5e3,timeout:5,template:"recent_item_template"},i||{}),this.element=t(e),this.tickerEl=this.element.children(this.options.tickerSel),this.enableEl=this.element.find(this.options.enableSel),this.statusEl=this.element.children(this.options.statusSel),this.loadingEl=this.element.find(this.options.loadingSel),this.errorEl=this.element.find(this.options.errorSel),this.regionEmptyEl=this.element.find(this.options.regionEmptySel),this.rows=0,this._initialize()};return e.prototype={_getListings:function(i){var n=this;i&&(this.options.region_filter=null);var r=this.options.api_path+(this.options.region_filter?"?"+t.param(this.options.region_filter):"");t.ajax({url:r,error:function(){n._handleError.call(n,e.Errors.REQUEST_FAILED)},success:function(t){n._processListings.call(n,t)},dataType:"json"})},_processListings:function(i){var n=i.results;if(!n||n.length<this.options.start_rows*this.options.per_row)return this._handleError(e.Errors.EMPTY_RESULTS);for(this._rows=[];n.length>=this.options.per_row;){var r={listings:n.splice(0,this.options.per_row)};this._rows.push(t(Etsy.template(this.options.template,r)))}this.tickerEl.animate({scrollTop:0}),this._addRow()},_finishListings:function(){return delete this._rows,this._idle<this.options.timeout?this._getListings():(this.disable(),void 0)},_addRow:function(){var t=this,e=this._rows.pop();if(e.prependTo(this.tickerEl),this.rows++,this.rows>=this.options.start_rows){var i=this.tickerEl.find(">*:first").height();return this.tickerEl.scrollTop(i).animate({delay:1},this.options.delay).animate({scrollTop:0},200,function(){t._didAddRow.call(t)})}this._didAddRow()},_didAddRow:function(){return this.rows>this.options.max_rows&&(this.tickerEl.find(">*:last").remove(),this.rows--),0==this._rows.length?this._finishListings():(this.statusEl.hide(),this._addRow(),void 0)},_handleError:function(t){t=t||e.Errors.UNKNOWN_ERROR,t==e.Errors.EMPTY_RESULTS?(this.errorEl.hide(),this.regionEmptyEl.show()):(this.errorEl.show(),this.regionEmptyEl.hide()),this.loadingEl.hide(),this.statusEl.show(),this.disable()},_setIdle:function(t){this._idle=t||this._idle+1},_initialize:function(){var t=this;this.element.bind("mousemove",function(){t._setIdle.call(t,-1)}),this.enableEl.bind("click",function(e){e.preventDefault(),t.enable.call(t),t.enableEl.blur()}),this.errorEl.children("a").bind("click",function(e){e.preventDefault(),t.enable.call(t)}),this._initialize=null,this.enable()},enable:function(){var t=this;return this._setIdle(-1),this._watch=window.setInterval(function(){t._setIdle.call(t)},1e3),this.enableEl.hide(),this._getListings(),!1},disable:function(){window.clearInterval(this._watch),this.enableEl.show()}},e.Errors={REQUEST_FAILED:1,EMPTY_RESULTS:2,UNKNOWN_ERROR:3},e});